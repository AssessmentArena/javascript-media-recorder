!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r;r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,r.QBMediaRecorder=e()}}(function(){return function e(r,o,t){function i(a,d){if(!o[a]){if(!r[a]){var s="function"==typeof require&&require;if(!d&&s)return s(a,!0);if(n)return n(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=o[a]={exports:{}};r[a][0].call(u.exports,function(e){var o=r[a][1][e];return i(o?o:e)},u,u.exports,e,r,o,t)}return o[a].exports}for(var n="function"==typeof require&&require,a=0;a<t.length;a++)i(t[a]);return i}({1:[function(e,r,o){"use strict";r.exports={unsupport:"QBMediaRecorder is not supported this environment.",unsupportMediaRecorderWithOptions:"Got a warning when creating a MediaRecorder, trying to create MediaRecorder without options.",requreArgument:"1 argument required, but only 0 present.",callbackError:"Founded an error in callback:",actionFailed:"QBMediaRecorder is not created or has an invalid state.",no_recorded_chunks:"Does not have any recording data.",streamRequired:"MediaStream is required.",InvalidState:"QBMediaRecorder is not in a state in which the proposed operation is allowed to be executed.",OutOfMemory:"The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",IllegalStreamModification:"A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",OtherRecordingError:"Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",GenericError:"The UA cannot provide the codec or recording option that has been requested"}},{}],2:[function(e,r,o){"use strict";function t(e){if(!t.isAvailable())throw new Error(i.unsupport);var r=!(!e||!e.mimeType)&&e.mimeType;this.mimeType=this._getMimeType(r),this.timeslice=e&&e.timeslice&&isNaN(+e.timeslice)?e.timeslice:1e3,this.callbacks=e?this._getCallbacks(e):{},this.recordedBlobs=[],this.ignoreMutedMedia=!e||"boolean"!=typeof e.ignoreMutedMedia||e.ignoreMutedMedia,this._stream=null,this._mediaRecorder=null,this._recordedChunks=[],this._keepRecording=!1,window&&window.lamejs&&(this.mp3encoder=new window.lamejs.Mp3Encoder(1,48e3,128),console.log(this.mp3encoder))}var i=e("./errors");t.prototype._getMimeType=function(e){var r,o="video";return e&&t.isTypeSupported(e)?r=e:e?(o=e.toString().toLowerCase().indexOf("audio")===-1?"video":"audio",r=t.getSupportedMimeTypes(o)[0]):r=t.getSupportedMimeTypes(o)[0],r},t.prototype._getCallbacks=function(e){var r={},o=["onstart","onstop","onpause","onresume","onerror","onchange","ondataavailable"];return o.forEach(function(o){o in e&&(r[o]=e[o])}),r},t._mimeTypes=e("./mimeTypes"),t._STATES=["inactive","recording","paused"],t.isAvailable=function(){return!!(window&&window.MediaRecorder&&"function"==typeof window.MediaRecorder.isTypeSupported&&window.Blob)},t.isTypeSupported=function(e){if(!t.isAvailable())throw new Error(i.unsupport);if(!e)throw new Error(i.requreArgument);return window.MediaRecorder.isTypeSupported(e)},t.getSupportedMimeTypes=function(e){var r=e||"video";if(!t.isAvailable())throw new Error(i.unsupport);return t._mimeTypes[r].filter(function(e){return t.isTypeSupported(e)})},t.prototype.getState=function(){return this._mediaRecorder?this._mediaRecorder.state:t._STATES[0]},t.prototype.start=function(e){var r=this;if(!e)throw new Error(i.requreArgument);var o=this.getState();o!==t._STATES[1]&&o!==t._STATES[2]||this._mediaRecorder.stop(),this._stream&&(this._stream=null),r._stream=e,r._mediaRecorder=null,r._recordedChunks.length=0,r._setMediaRecorder(),r._setEvents()},t.prototype._setMediaRecorder=function(){var e=this;try{e._mediaRecorder=new window.MediaRecorder(e._stream,{mimeType:e.mimeType,ignoreMutedMedia:e.ignoreMutedMedia})}catch(r){console.warn(i.unsupportMediaRecorderWithOptions,r),e._mediaRecorder=new window.MediaRecorder(e._stream)}},t.prototype._setEvents=function(){function e(e,o){if(0!==Object.keys(r.callbacks).length&&"function"==typeof r.callbacks[e])try{r.callbacks[e](o)}catch(r){console.error("Founded an error in callback:"+e,r)}}var r=this;r._mediaRecorder.ondataavailable=function(o){o.data&&o.data.size>0&&(r._recordedChunks.push(o.data),e("ondataavailable",o))},r._mediaRecorder.onpause=function(){e("onpause")},r._mediaRecorder.onresume=function(){e("onresume")},r._mediaRecorder.onerror=function(o){switch(o.name){case"InvalidState":console.error(i[o.name]);break;case"OutOfMemory":console.error(i[o.name]);break;case"IllegalStreamModification":console.error(i[o.name]);break;case"OtherRecordingError":console.error(i[o.name]);break;case"GenericError":console.error(i[o.name]);break;default:console.error("MediaRecorder Error",o)}"inactive"!==r._mediaRecorder.state&&"stopped"!==r._mediaRecorder.state&&r._mediaRecorder.stop(),r._userCallbacks&&"function"==typeof r._userCallbacks.onErrorRecording&&e("onerror",o)},r._mediaRecorder.onstop=function(){console.log(r._recordedChunks);var o=new Blob(r._recordedChunks,{type:r.mimeType});r.recordedBlobs.push(o),r._keepRecording||(r.recordedBlobs.length>1?e("onstop",o):e("onstop",r.recordedBlobs[0])),r._keepRecording=!1},r._mediaRecorder.start(r.timeslice),e("onstart")},t.prototype.stop=function(){var e=this._mediaRecorder,r=e&&e.state?e.state:"inactive";e&&"recording"===r?e.stop():console.warn(i.actionFailed)},t.prototype.pause=function(){var e=this;e._mediaRecorder&&"recording"===e._mediaRecorder.state?e._mediaRecorder.pause():console.warn(i.actionFailed)},t.prototype.resume=function(){var e=this;e._mediaRecorder&&"paused"===e._mediaRecorder.state?e._mediaRecorder.resume():console.warn(i.actionFailed)},t.prototype.change=function(e){var r=this;if(!e)throw new Error(i.requreArgument);r._keepRecording=!0,r.stop(),r._stream=null,r._mediaRecorder=null,r._stream=e,r._setMediaRecorder(),r._setEvents()},t.prototype.download=function(e,r){var o=this,i=this.getState();i!==t._STATES[1]&&i!==t._STATES[2]||this._mediaRecorder.stop();var n=URL.createObjectURL(r||o._getBlobRecorded()),a=document.createElement("a");a.style.display="none",a.href=n,a.download=(e||Date.now())+"."+o._getExtension(),document.body.appendChild(a),a.click(),setTimeout(function(){document.body.removeChild(a),window.URL.revokeObjectURL(n)},100)},t.prototype._getBlobRecorded=function(e){var r=this,o=e||r._recordedChunks;return o.length?new Blob(o,{type:r.mimeType}):(console.warn(i.no_recorded_chunks),!1)},t.prototype._getExtension=function(){var e=this,r=e.mimeType.indexOf("/"),o=e.mimeType.substring(r+1),t=o.indexOf(";");return t!==-1&&(o=o.substring(0,t)),o},r.exports=t},{"./errors":1,"./mimeTypes":3}],3:[function(e,r,o){"use strict";r.exports={audio:["audio/webm;codecs=opus","audio/webm","audio/ogg","audio/wav","audio/mp3"],video:["video/webm;codecs=h264","video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm;codecs=daala","video/webm","video/mp4","video/mpeg"]}},{}]},{},[2])(2)});