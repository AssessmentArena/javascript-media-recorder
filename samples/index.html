<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Media Stream Recorder by Quickblox</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="icon" href="https://docsdev.quickblox.com/themes/quickblox/templates/main_resources/favicon.ico">

    <link rel="stylesheet" href="main.css">
</head>
<body>
    <div class="wrap">
        <header class="title">
            <h1 class="title_main">Media Stream Recorder
                <span class="title_sub">by&nbsp;Quickblox</span>
            </h1>
        </header>

        <aside class="note">
            This demo requires Firefox&nbsp;49, Chrome&nbsp;49, Chrome&nbsp;for&nbsp;Android&nbsp;53, Opera&nbsp;41 or&nbsp;later.
        </aside>
        
        <main class="app">
            <div class="screen">
                <video class="j-video video" muted></video>

                <div class="actions">
                    <button class="btn j-start">Start</button>
                    <button class="btn j-pause">Pause</button>
                    <button class="btn j-resume">Resume</button>
                    <button class="btn j-stop">Stop</button>
                </div>
            </div>

            <div class="screenRepeat">
                <video class="j-videoRecorded video" controls></video>
            </div>
        </main>
    </div>

    <footer class="footer">
        See <a href="../docs/index.html" target="_blank">docs</a>
    </footer>
    
    <script src="../mediaRecorder.js"></script>
    
    <script>
        var recorder = null,
            recorderOpts = {
                callbacks: {
                    onStart: function onStart() {
                        console.info('onStart callback');
                    },
                    onStop: function onStop(blob) {
                        console.info('onStop callback');
                        
                        var videoEl = document.querySelector('.j-videoRecorded');
                        videoEl.src = URL.createObjectURL(blob);
                    }
                }
            },
            constraints = { audio: true, video: true };

        function handleGetStreamSuccess(stream) {
            var videoEl = document.querySelector('.j-video');

            recorder = new qbMediaRecorder(stream, recorderOpts);
            
            videoEl.src = URL.createObjectURL(stream);
            videoEl.play();
       }

        function handleGetStreamError(error) {
            console.error(error.name + ': ' + error.message, error);
        }

        navigator.mediaDevices.getUserMedia(constraints)
            .then(handleGetStreamSuccess)
            .catch(handleGetStreamError);

        /** Event listeners */
        document.querySelector('.j-start').addEventListener('click', function() {
            recorder.start();
        });

        document.querySelector('.j-stop').addEventListener('click', function() {
            recorder.stop();
        });

    </script>
</body>
</html>